---
title: "Draft for sequencing data download"
author: "Morten Dall"
output: html_document
---

```{r setup, include=FALSE}
library(GEOquery)
library(tidyverse)
library(fs)
library(vroom)
library(Biobase)
library(here)
library(magrittr)
library(data.table)
library(clusterProfiler)
library(org.Hs.eg.db)
library(edgeR)
library(openxlsx)

```




```{r}




empty_list <- vector(mode = "list",length = 4)

empty_list[[1]]<- results[[1]]
for (i in 1:4){
  empty_list[[i]]<- results[[i]] %>% 
    filter(FDR<0.05) 
} 
for (i in 1:4){
    names(empty_list)[i]<-names(results)[i]
}

bg_list <- results[[1]][[7]] 
  bg_list = clusterProfiler::bitr(
  bg_list,
  fromType = "SYMBOL",
  toType = "ENTREZID",
  OrgDb = "org.Hs.eg.db",
  drop = T
)


eg <- vector(mode = "list",length = 4)

for (i in 1:4) {
  eg[[i]] <- clusterProfiler::bitr(
    empty_list[[i]][[7]],
    fromType = "SYMBOL",
    toType = "ENTREZID",
    OrgDb = "org.Hs.eg.db",
    drop = T
  )
}

for (i in 1:4){
    names(eg)[i]<-names(results)[i]
}

names(eg[1])<-""

goResults <- vector(mode = "list",length = 4)

for (i in 1:4){
goResults <- enrichGO(gene = eg[[3]]$ENTREZID,
                      universe = bg$ENTREZID,
                      OrgDb = org.Hs.eg.db,
                      ont = "BP")
}




plot_test <- dotplot(goResults)
plot_test
goResults <- setReadable(goResults, OrgDb = org.Hs.eg.db, keyType="ENTREZID")
write.xlsx(goResults@result, file = here("data/NASH_NAFLD_GOterms.xlsx"), asTable = TRUE)
cnet <- cnetplot(goResults)



```


```{r}
goTerms <- goResults@results[1] %>%
  filter(ID == "GO:0009435"	)
View(goTerms)
NADGenes <- goTerms$geneID
NADGenes_list <- unlist(strsplit(NADGenes, "/"))

significant_NAD_terms <- resultTable %>%
  filter(rownames(resultTable) %in% NADGenes_list)
View(significant_NAD_terms)

Selected_candidates <- c("NAMPT", 
                         "NMNAT1", 
                         "NMNAT2", 
                         "NMNAT3", 
                         "NMRK1", 
                         "NMRK2", 
                         "NADSYN1", 
                         "NADSYN", 
                         "TDO2", 
                         "IDO", 
                         "NAPRT", 
                         "SIRT1", 
                         "SIRT3", 
                         "PARP1", 
                         "CD38", 
                         "NNMT", 
                         "NADK", 
                         "HADH", 
                         "KMO",
                         "AFMID")
NAD_screen <- resultTable %>%
  filter(rownames(resultTable) %in% Selected_candidates)
View(NAD_screen)

ggplot(NAD_screen, aes(x = logFC, y = -log10(adj.P.Val))) +
  geom_point()

```

