---
title: "Draft for sequencing data download"
author: "Morten Dall"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(fs)
library(vroom)

```

##Function to download GEO data
```{r}
gds <- getGEO("GSE126848",GSEMatrix = T, getGPL = F)

metadata <- pData(gds$GSE126848_series_matrix.txt.gz)[idxRNA, c( "gender:ch1", "disease:ch1", "description")]
write.table(metadata, file = "metadata.csv")


geoFile <- getGEOSuppFiles("GSE126848", makeDirectory = F,baseDir = here("data-raw/"))

geo_file <- dir_ls(here("data-raw/"), 
                          regexp = "txt", 
                          recurse = TRUE)

count_matrix <- vroom(geo_file)


matrix_key <- count_matrix$key
count_matrix <- count_matrix %>% 
  dplyr::select(-1)

rownames(count_matrix) <- matrix_key
View(count_matrix)

column_order = t(count_matrix[1,])
column_order <- as.data.frame(column_order)
column_order[1,]<- as.character(column_order[1,])

column_ID <- metadata %>% 
  select(c(description, `disease:ch1`)) 
colnames(column_ID)[1] = "key"

column_order <- left_join(column_order,column_ID, by = "key")

count_matrix_anno <- count_matrix
colnames(count_matrix_anno) <- count_matrix_anno[1,]
count_matrix_anno[1,] <- column_order[,2]

```

